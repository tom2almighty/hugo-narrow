{{/* 文章卡片基础组件 - 用于主文章列表显示
  @context {page} .page 文章页面对象
*/}}

{{ $page := .page }}

{{/* 使用通用图片处理器仅生成真实设置的cover图的URL */}}
{{- $coverImage := "" -}}
{{- if $page.Params.cover -}}
  {{- partial "content/image-processor.html" (dict
    "context" $page
    "src" $page.Params.cover
    "enablePlaceholder" false
    "outputType" "data"
  ) -}}
  {{- $coverImage = $page.Scratch.Get "imageUrl" -}}
{{- end -}}

{{- $summaryContent := "" -}}
{{- if $page.Params.summary -}}
  {{- $summaryContent = $page.Params.summary -}}
{{- else if $page.Params.description -}}
  {{- $summaryContent = $page.Params.description -}}
{{- else if $page.Summary -}}
  {{- $summaryContent = $page.Summary | plainify | truncate 140 -}}
{{- end -}}

{{/* 文章卡片 */}}
<article class="group">
  <a href="{{ $page.RelPermalink }}" class="block">
    <div class="bg-card border-border hover:bg-primary/5 hover:border-primary/20 focus:ring-primary/20 relative flex flex-col md:flex-row overflow-hidden rounded-xl border transition-all duration-300 ease-out hover:-translate-y-1 hover:scale-[1.02] hover:shadow-lg focus:ring-2 focus:outline-none">
      
      <!-- 封面图片 -->
      {{- if $coverImage -}}
        <div class="p-3 pb-0 md:p-3 md:pl-0 md:order-last md:w-64 md:shrink-0">
          <div class="relative overflow-hidden rounded-lg aspect-video w-full h-full md:aspect-video">
            <img 
              src="{{ $coverImage }}" 
              alt="{{ $page.Title }}" 
              class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105" 
              loading="lazy" />
          </div>
        </div>
      {{- end -}}

      <!-- 文章内容区域 -->
      <div class="flex flex-1 flex-col p-6 gap-4 justify-center">
        <!-- 文章标题 -->
        <h3 class="text-foreground group-hover:text-primary text-xl font-bold leading-tight transition-colors duration-200">
          {{ $page.Title }}
        </h3>

        <!-- 文章摘要 -->
        {{ if $summaryContent }}
          <p class="text-muted-foreground text-sm leading-relaxed line-clamp-3 md:line-clamp-2">
            {{ $summaryContent }}
          </p>
        {{ end }}

        <!-- 元信息 -->
        <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-muted-foreground mt-2">
          <!-- 时间信息行 -->
          <div class="flex items-center gap-1.5">
            {{ partial "features/icon.html" (dict "name" "calendar" "size" "sm" "ariaLabel" (i18n "post.published_on")) }}
            <time datetime="{{ $page.Date.Format "2006-01-02" }}" class="font-medium">
              {{ dateFormat (i18n "time.date_format" | default "2006年01月02日") $page.Date }}
            </time>
          </div>
          
          <!-- 预计阅读时间 -->
          {{ if $page.ReadingTime }}
            <div class="flex items-center gap-1.5">
              {{ partial "features/icon.html" (dict "name" "clock" "size" "sm" "ariaLabel" (i18n "post.reading_time")) }}
              <span class="font-medium truncate">{{ $page.ReadingTime }} {{ i18n "time.minute" | default "min" }}</span>
            </div>
          {{ end }}

          <!-- 标签行 -->
          {{ if isset $page.Params "tags" }}
            <div class="flex flex-wrap items-center gap-1.5 ml-auto md:ml-0">
              {{ range $tag := $page.Params.tags }}
                <span class="bg-muted/50 border-muted/30 flex items-center gap-1 rounded-md border px-2 py-0.5 text-xs">
                  <span class="font-medium">{{ $tag }}</span>
                </span>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </div>
    </div>
  </a>
</article>
