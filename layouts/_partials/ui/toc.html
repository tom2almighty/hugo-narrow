{{- $tocConfig := partial "config/toc.html" . -}}
{{- if and $tocConfig.enabled (ne .TableOfContents `<nav id="TableOfContents"></nav>`) -}}
  <aside id="toc-container" class="toc-{{ $tocConfig.position }}" data-position="{{ $tocConfig.position }}">
    {{- if eq $tocConfig.position "center" -}}
      <!-- Center 模式 TOC -->
      <div id="toc-center" class="pointer-events-none fixed left-0 right-0 top-28 z-40 mx-auto w-full max-w-4xl px-4 transition-all duration-300">
        <div class="pointer-events-auto relative mx-auto w-fit">
          <button id="toc-center-toggle" class="bg-card/80 border-border text-muted-foreground hover:text-primary hover:bg-primary/10 flex items-center gap-2 rounded-full border px-4 py-1.5 text-sm backdrop-blur-sm transition-colors cursor-pointer shadow-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
            {{ partial "features/icon.html" (dict "name" "list" "size" "sm" "ariaLabel" "") }}
            <span id="toc-center-title" class="truncate max-w-[200px]">{{ i18n "dock.toc" | default "目录" }}</span>
            {{ partial "features/icon.html" (dict "name" "chevron-down" "size" "xs" "ariaLabel" "") }}
          </button>
          
          <!-- Dropdown 内容 -->
          <div id="toc-center-dropdown" class="bg-card border-border absolute left-1/2 top-full mt-2 hidden max-h-[60vh] w-[280px] -translate-x-1/2 overflow-y-auto rounded-xl border p-4 shadow-lg transition-all opacity-0 origin-top scale-95 scrollbar-hide">
            <div id="toc-center-content" class="text-sm [&_nav>ul]:pl-0 [&_ul]:list-none [&_ul]:pl-4 [&_li]:my-1.5 [&_a]:block [&_a]:rounded-md [&_a]:px-2 [&_a]:py-1 [&_a]:text-muted-foreground [&_a]:transition-colors [&_a:hover]:bg-primary/10 [&_a:hover]:text-primary [&_a.active]:bg-primary/10 [&_a.active]:text-primary [&_a.active]:font-medium [&_a]:truncate">
              {{ .TableOfContents }}
            </div>
          </div>
        </div>
      </div>
    {{- else if eq $tocConfig.position "side" -}}
      <!-- Side 模式 TOC -->
      <div id="toc-side" class="fixed right-0 top-24 z-40 flex flex-col items-end">
        <!-- 侧边指示色块区 -->
        <div id="toc-side-indicator" class="relative flex w-6 flex-col items-end gap-[2px] py-4 cursor-ns-resize h-[calc(100vh-12rem)] max-h-[400px]">
        </div>

        <!-- Hover 悬浮的详细目录卡片 -->
        <div id="toc-side-dropdown" class="bg-card border-border absolute right-0 top-0 max-h-[80vh] w-64 md:w-80 overflow-y-auto rounded-l-xl border-y border-l p-4 shadow-xl transition-all duration-300 opacity-0 translate-x-8 pointer-events-none scrollbar-hide [&.is-open]:pointer-events-auto [&.is-open]:opacity-100 [&.is-open]:translate-x-0">
          <div class="mb-3 flex items-center justify-between text-sm font-bold text-foreground">
            <span>{{ i18n "dock.toc" | default "目录" }}</span>
            <button id="toc-side-close" class="text-muted-foreground hover:text-foreground hidden [&.is-touch]:block rounded p-1">
              {{ partial "features/icon.html" (dict "name" "close" "size" "xs" "ariaLabel" "") }}
            </button>
          </div>
          <div id="toc-side-content" class="text-sm [&_nav>ul]:pl-0 [&_ul]:list-none [&_ul]:pl-4 [&_li]:my-1.5 [&_a]:block [&_a]:rounded-md [&_a]:px-2 [&_a]:py-1 [&_a]:text-muted-foreground [&_a]:transition-colors [&_a:hover]:bg-primary/10 [&_a:hover]:text-primary [&_a.active]:bg-primary/10 [&_a.active]:text-primary [&_a.active]:font-medium [&_a]:wrap-break-word [&_a]:whitespace-normal">
            {{ .TableOfContents }}
          </div>
        </div>
      </div>
    {{- end -}}
  </aside>
{{- end -}}
