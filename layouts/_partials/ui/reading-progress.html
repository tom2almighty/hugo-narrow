{{/* 阅读进度条组件 */}}
{{- $enabled := site.Params.readingProgress.enabled | default true -}}
{{- $showOnHomepage := site.Params.readingProgress.showOnHomepage | default false -}}

{{- $shouldShow := false -}}
{{- if $enabled -}}
  {{- if eq .Kind "home" -}}
    {{- $shouldShow = $showOnHomepage -}}
  {{- else -}}
    {{- $shouldShow = true -}}
  {{- end -}}
{{- end -}}

{{- if $shouldShow -}}
  <div
    id="reading-progress-bar"
    class="from-primary to-primary/80 pointer-events-none fixed top-0 left-0 z-50 h-[3px] w-0 bg-gradient-to-r transition-[width] duration-150 ease-out"
  ></div>

  <script>
    (function () {
      const bar = document.getElementById("reading-progress-bar");
      if (!bar) return;

      function update() {
        const scrolled = window.scrollY;
        const total = document.documentElement.scrollHeight - window.innerHeight;
        bar.style.width = total > 0 ? (scrolled / total) * 100 + "%" : "0%";
      }

      let ticking = false;
      window.addEventListener(
        "scroll",
        () => {
          if (!ticking) {
            requestAnimationFrame(() => {
              update();
              ticking = false;
            });
            ticking = true;
          }
        },
        { passive: true }
      );

      update();
    })();
  </script>
{{- end -}}
