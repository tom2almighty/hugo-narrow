{{ define "main" }}
  <!-- 页面头部区域: 图、标题、摘要 -->
  <header class="mb-10">
    <!-- 项目封面图片 -->
    {{- if .Params.cover -}}
      {{/* 使用通用图片处理器 */}}
      {{- partial "content/image-processor.html" (dict
        "context" .
        "src" .Params.cover
        "alt" .Title
        "enableModal" false
        "enableResponsive" true
        "enablePlaceholder" false
        "outputType" "data"
        )
      -}}
      {{- $coverImage := .Scratch.Get "imageUrl" -}}

      {{- if $coverImage -}}
        <div class="border-border mb-8 overflow-hidden rounded-2xl border shadow-sm">
          <img
            src="{{ $coverImage }}"
            alt="{{ .Title }}"
            class="aspect-video w-full object-cover md:aspect-auto md:h-112"
            loading="eager"
          />
        </div>
      {{- end -}}
    {{ end }}


    <!-- 标题 -->
    <h1 class="text-foreground mb-4 text-3xl font-bold md:text-4xl lg:text-5xl">
      {{ .Title }}
    </h1>

    <!-- 摘要 -->
    {{ if .Params.summary }}
      <div class="text-muted-foreground text-lg leading-relaxed md:text-xl">
        {{ .Params.summary | plainify }}
      </div>
    {{ end }}
  </header>

  <!-- 中间部分：精多元数据信息展板 (Information Showcase) -->
  <div class="mb-12">
    <div class="bg-card border-border relative overflow-hidden rounded-2xl border shadow-sm">
      <!-- 柔和的顶部装饰条 -->
      <div
        class="from-primary/60 to-primary/20 absolute top-0 left-0 h-1 w-full bg-linear-to-r"
      ></div>

      <div class="p-6 md:p-8 lg:p-10">
        <div class="grid grid-cols-1 items-start gap-x-8 gap-y-10 md:grid-cols-2 lg:grid-cols-4">
          <!-- 发布日期 -->
          <div class="flex flex-col gap-3">
            <span
              class="text-muted-foreground flex items-center gap-1.5 text-xs font-bold tracking-widest uppercase"
            >
              {{ partial "features/icon.html" (dict "name" "calendar" "size" "xs" "ariaLabel" "") }}
              {{ i18n "post.published_on" | default "Published" }}
            </span>
            <div class="text-foreground text-base font-semibold">
              <time datetime="{{ .Date.Format "2006-01-02" }}">
                {{ dateFormat (i18n "time.date_format" | default "Jan 02, 2006") .Date }}
              </time>
            </div>
          </div>

          <!-- 项目状态 -->
          {{ if .Params.status }}
            <div class="flex flex-col gap-3">
              <span
                class="text-muted-foreground flex items-center gap-1.5 text-xs font-bold tracking-widest uppercase"
              >
                {{ partial "features/icon.html" (dict "name" "status" "size" "xs" "ariaLabel" "") }}
                {{ i18n "project.status" | default "Status" }}
              </span>
              <div class="text-foreground flex items-center text-base font-semibold">
                <!-- 状态指示圆点 -->
                <span class="relative mt-0.5 mr-2.5 flex h-2.5 w-2.5">
                  <span
                    class="{{ if eq .Params.status "completed" }}
                      bg-green-400
                    {{ else if eq .Params.status "in_progress" }}
                      bg-blue-400
                    {{ else }}
                      bg-primary
                    {{ end }} absolute inline-flex h-full w-full animate-ping rounded-full opacity-75"
                  ></span>
                  <span
                    class="{{ if eq .Params.status "completed" }}
                      bg-green-500
                    {{ else if eq .Params.status "in_progress" }}
                      bg-blue-500
                    {{ else }}
                      bg-primary
                    {{ end }} relative inline-flex h-2.5 w-2.5 rounded-full"
                  ></span>
                </span>
                <span>
                  {{ if eq .Params.status "completed" }}
                    {{ i18n "project.status_completed" | default "Completed" }}
                  {{ else if eq .Params.status "in_progress" }}
                    {{ i18n "project.status_in_progress" | default "In Progress" }}
                  {{ else if eq .Params.status "planning" }}
                    {{ i18n "project.status_planning" | default "Planning" }}
                  {{ else }}
                    {{ .Params.status }}
                  {{ end }}
                </span>
              </div>
            </div>
          {{ end }}


          <!-- Tags 标签 -->
          {{ if .Params.tags }}
            <div class="flex flex-col gap-3 lg:col-span-2">
              <span
                class="text-muted-foreground flex items-center gap-1.5 text-xs font-bold tracking-widest uppercase"
              >
                {{ partial "features/icon.html" (dict "name" "tag" "size" "xs" "ariaLabel" "") }}
                {{ i18n "project.tags" | default "Tags" }}
              </span>
              <div class="flex flex-wrap gap-2.5">
                {{ range .Params.tags }}
                  <a
                    href="{{ "/tags/" | relLangURL }}{{ . | urlize }}/"
                    class="bg-muted/40 text-foreground border-border hover:bg-primary hover:text-primary-foreground hover:border-primary inline-flex rounded-lg border px-3 py-1.5 text-sm font-medium shadow-sm transition-all"
                  >
                    {{ . }}
                  </a>
                {{ end }}
              </div>
            </div>
          {{ end }}

        </div>

        <!-- 外部链接 - 定位于右上角 -->
        {{ if .Params.link }}
          <div class="absolute top-6 right-6 md:top-8 md:right-8">
            <a
              href="{{ .Params.link }}"
              target="_blank"
              rel="noopener noreferrer"
              class="group bg-primary/10 text-primary hover:bg-primary hover:text-primary-foreground focus:ring-primary/20 flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold transition-all focus:ring-2 focus:outline-none"
            >
              <span class="tracking-wide"
                >{{ i18n "project.visit_project" | default "Visit" }}</span
              >
              {{ partial "features/icon.html" (dict "name" "external-link" "size" "sm" "ariaLabel" "") }}
            </a>
          </div>
        {{ end }}
      </div>
    </div>
  </div>

  <!-- 正文区域 (垂直布局最底部) -->
  <div class="bg-card border-border rounded-xl border p-6 shadow-sm md:p-8 md:px-10">
    <article class="prose prose-neutral dark:prose-invert max-w-none">
      {{ .Content }}
    </article>
  </div>

  <!-- 评论组件 -->
  <div class="mt-12">
    {{ partial "features/comments.html" . }}
  </div>
{{ end }}
