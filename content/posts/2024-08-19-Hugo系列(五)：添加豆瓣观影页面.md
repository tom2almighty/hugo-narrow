---
categories: 
- å®ç”¨æ•™ç¨‹
cover: ''
date: 2024-08-19 18:00:09+08:00
description: é€šè¿‡ GitHub doumark-action ä¿å­˜è±†ç“£è§‚å½±æ•°æ®ï¼Œå¹¶ç»™ Hugo åšå®¢æ·»åŠ è±†ç“£è§‚å½±é¡µé¢ã€‚
slug: hugo-douban
summary: é€šè¿‡ GitHub doumark-action ä¿å­˜è±†ç“£è§‚å½±æ•°æ®ï¼Œå¹¶ç»™ Hugo åšå®¢æ·»åŠ è±†ç“£è§‚å½±é¡µé¢ã€‚
tags:
- Hugo
title: Hugoç³»åˆ—(äº”)ï¼šæ·»åŠ è±†ç“£è§‚å½±é¡µé¢
---
é€šè¿‡ GitHub doumark-action ä¿å­˜è±†ç“£è§‚å½±æ•°æ®ï¼Œå¹¶ç»™ Hugo åšå®¢æ·»åŠ è±†ç“£è§‚å½±é¡µé¢ã€‚
<!--more-->

> [!NOTE]
>
> 2025.03.29  æ›´æ–°äº†ä¸€ä¸‹æ¨¡æ¿æ–‡ä»¶ï¼Œæ·»åŠ äº†ç­›é€‰æ’åºåŠŸèƒ½ã€‚
>
> å·²å°† `data.GetCSV` å‡½æ•°æ›¿æ¢ï¼ŒHugo ä¼šåœ¨ `0.136` ç‰ˆæœ¬ç§»é™¤ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬æ˜¯ `0.135`ã€‚
> å–è€Œä»£ä¹‹çš„æ˜¯ `resources.Get` å’Œ `transform.Unmarshal`ï¼Œç”±äº `resource` å‡½æ•°è·å–å…¨å±€æ–‡ä»¶è·¯å¾„æ˜¯ `~/assets/`ï¼Œå› æ­¤ä¹Ÿæ›¿æ¢äº†å¯¹åº”æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚

## å‰è¨€

`Hexo` æœ‰ [hexo-douban](https://github.com/mythsman/hexo-douban) é¡¹ç›®ï¼Œå¯ä»¥æ·»åŠ è§‚å½±æ•°æ®åˆ°é¡µé¢ï¼Œæ›´æ¢ `Hugo` åä¹Ÿæƒ³æ·»åŠ ä¸€ä¸ªè§‚å½±é¡µé¢ï¼ŒæŸ¥æ‰¾èµ„æ–™åå‘ç°æœ‰ä¸€ä¸ª `doumark-action` é¡¹ç›®å¯ä»¥å°†è§‚å½±æ•°æ®ä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶ï¼Œç„¶åå¯ä»¥é€šè¿‡ Hugo çš„å‡½æ•°è·å–æ•°æ®ï¼Œå†å‰ç«¯å±•ç¤ºï¼Œå‰é¢çš„æ–‡ç« ä¸­å·²ç»æ·»åŠ äº†è±†ç“£æ¡ç›®çš„çŸ­ä»£ç ï¼Œè¿™ç¯‡æ–‡ç« å†è¡¥å……ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯è¿‘æœŸè§‚å½±çš„çŸ­ä»£ç ï¼Œå¦å¤–æ˜¯æ·»åŠ ä¸€ä¸ªæµ·æŠ¥å¢™é¡µé¢ã€‚
æœ€ç»ˆå®ç°çš„æ ·å¼å¸ƒå±€å‚è€ƒäº†ä¸€äº›åšä¸»çš„æ–‡ç« å’Œä»“åº“ä»£ç ï¼š
- [Hugo ã€Œè¿‘æœŸã€çŸ­ä»£ç ï¼ˆåŸºäº Doumark Actionsï¼‰](https://immmmm.com/hugo-shortcodes-recently-by-douban/)
- [Koobaiåšå®¢](https://koobai.com/movies/)
- [å…ƒåŸ¹çš„å…ƒè§†è§’](https://blog.yuanpei.me/)

## ä¿å­˜æœ¬åœ°æ•°æ®

ç”±äºè±†ç“£ `API` çš„é™åˆ¶ï¼Œä¹‹å‰çš„ä¸€äº›åœ¨çº¿è·å–æ•°æ®æ–¹å¼å·²ç»å¤±æ•ˆäº†ï¼Œå¯ä»¥é€šè¿‡åœ¨çº¿çˆ¬å–æ ‡è®°çš„æ•°æ®åˆ°æœ¬åœ°ï¼Œç„¶åæ“ä½œæœ¬åœ°çš„æ•°æ®æ–‡ä»¶ï¼Œå†å‰ç«¯å±•ç¤ºæ•°æ®ã€‚
ç”¨åˆ°çš„é¡¹ç›®æ˜¯ [doumark-action](https://github.com/lizheming/doumark-action)ã€‚
é¦–å…ˆåœ¨åšå®¢ä»“åº“çš„æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª `Workflow`ï¼Œæ–°å»º `.github/workflows/douban.yml ` æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å†™å…¥è‡ªå·±æƒ³è¦ä¿å­˜çš„æ•°æ®ï¼Œå½±éŸ³ã€ä¹¦ç±ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åˆ° `Notion`ï¼Œé¡¹ç›®æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œè¿™é‡Œè´´ä¸€ä¸‹æˆ‘çš„é…ç½®ï¼Œå…¶ä¸­å°† `id` æ”¹ä¸ºè‡ªå·±çš„è±†ç“£ `ID`ã€‚

```yaml
# .github/workflows/douban.yml
name: douban
on: 
  schedule:
  - cron: "30 * * * *"
  workflow_dispatch:

jobs:
  douban:
    name: Douban mark data sync
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: movie
      uses: lizheming/doumark-action@master
      with:
        id: 222317686
        type: movie
        format: csv
        dir: ./assets/data/douban
    
    - name: book
      uses: lizheming/doumark-action@master
      with:
        id: 222317686
        type: book
        format: csv
        dir: ./assets/data/douban
  
    - name: Commit
      uses: EndBug/add-and-commit@v8
      with:
        message: 'chore: update douban data'
        add: './assets/data/douban'
```

> [!TIP]
> å¦‚æœä½¿ç”¨ `data.GetCSV` å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ç«™ç‚¹æ ¹ç›®å½•ä¸‹çš„ ` data ` ç›®å½•ï¼Œ[ä¹‹å‰](https://discourse.gohugo.io/t/csv-unexpected-data-type-string-in-file/17421/3)ä¹Ÿæœ‰äººå‡ºç°åŒç±»å‹çš„é”™è¯¯ï¼Œæ›´æ”¹ç›®å½•åå°±æ­£å¸¸äº†ã€‚

> When working with local data, the file path is relative to the working directory. 
> You must not place CSV files in the projectâ€™s data directory.
> æ¥è‡ª [Hugo æ–‡æ¡£](https://gohugo.io/functions/data/getcsv/)


ä¹‹åå¯ä»¥åœ¨ä»“åº“æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹ `action`ï¼Œå®Œæˆåä¼šåœ¨ `~/assets/data/douban/` ç”Ÿæˆ `movie.csv` å’Œ `book.csv` ï¼Œè¿™å°±æ˜¯ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶ã€‚
## è¿‘æœŸè§‚å½±çŸ­ä»£ç 
### é…ç½®
è¦æ·»åŠ çŸ­ä»£ç éœ€è¦åœ¨ `~/layouts/shortcodes/` ç›®å½•ä¸‹æ–°å»ºçŸ­ä»£ç æ¨¡æ¿æ–‡ä»¶ï¼Œè¿™é‡Œä¸º `recent-douban.html`ï¼Œåœ¨å…¶ä¸­æ·»åŠ æ¨¡æ¿å…ƒç´ ï¼š

```html
{{ $type := .Get "type" }}
{{ $count := .Get "count" | default 4 }}
{{ $count = add $count 1 }}
{{ $items := slice }}
{{ $csvPath := "" }}
{{ if eq $type "movies" }}
    {{ $csvPath = "data/douban/movie.csv" }}
{{ else if eq $type "books" }}
    {{ $csvPath = "data/douban/book.csv" }}
{{ end }}

{{ with resources.Get $csvPath }}
    {{ $opts := dict "delimiter" "," }}
    {{ $items = . | transform.Unmarshal $opts }}
{{ else }}
    {{ errorf "æ— æ³•è·å–èµ„æº %q" $csvPath }}
{{ end }}

<div class="recent-items">
    {{ range $idx, $item := first $count $items }}
        {{ if ne $idx 0 }}
            {{ $rating := float (index $item 6) }}
            <div class="recent-item">
                <div class="recent-item-cover">
                    <img class="avatar" src="{{ index $item 3 }}" referrer-policy="no-referrer" loading="lazy" alt="{{ index $item 9 }}" title="{{ index $item 1 }}" width="150" height="220">
                </div>
                <div class="recent-douban-rating">
                    <div class="rating">
                        <span class="allstardark">
                            <span class="allstarlight" style="width:{{ mul 10 $rating }}%"></span>
                        </span>
                        <span class="rating_nums">{{ $rating }}</span>
                    </div>
                </div>
                <div class="recent-item-title">
                    <a rel="noreferrer" href="{{ index $item 5 }}" target="_blank">{{ index $item 1 }}</a>
                </div>
            </div>
        {{ end }}
    {{ end }}
</div>
```

ç„¶åæ·»åŠ ä¸€ä¸‹æ ·å¼ä»£ç ï¼Œè¿™é‡Œå’Œä¹‹å‰çš„æ–‡ç« ä¿æŒä¸€è‡´ï¼Œæ·»åŠ åˆ° `shortcodes.scss` ä¸­ï¼š

```scss
.recent-items {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin: 15px;
}
.recent-items .recent-item, .recent-items .recent-item img {
    margin-bottom: 10px;
}
```

> [!IMPORTANT]
> ä¹‹å‰çš„è±†ç“£æ¡ç›®çŸ­ä»£ç æ ·å¼æ–‡ä»¶å·²ç»æ·»åŠ äº†è¯„åˆ†æ˜Ÿçº§çš„æ ·å¼ `allstarlight`ï¼Œæ‰€ä»¥è¿™é‡Œä¸æ·»åŠ ï¼Œå¦‚æœä¹‹å‰æ²¡æ·»åŠ è¿‡çš„è¯éœ€è¦æ·»åŠ ç›¸å…³çš„æ ·å¼ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« å¯ä»¥æ‰¾åˆ°ã€‚


### ä½¿ç”¨

ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

```
{\{< recent-douban type="movies" count=8 >}\}
{\{< recent-douban type="books" >}\}
```

é»˜è®¤å±•ç¤ºå››æ¡æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ `count` å‚æ•°æŒ‡å®šæ˜¾ç¤ºçš„æ•°é‡ã€‚


## è§‚å½±é¡µé¢
### é…ç½®

æ·»åŠ ä¸€ä¸ªæµ·æŠ¥å¢™é¡µé¢å±•ç¤ºæ‰€æœ‰çš„è§‚å½±ä¿¡æ¯ï¼Œé»˜è®¤å±•ç¤º `18` æ¡ä¿¡æ¯ã€‚

é¦–å…ˆåœ¨ `~/lauouts/_default/` æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ¨¡æ¿æ–‡ä»¶ï¼Œè¿™é‡Œä¸º `posterwall.html`ï¼Œç„¶ååœ¨å…¶ä¸­æ·»åŠ é¡µé¢å…ƒç´ ï¼š

```html
{{- define "title" -}}
  {{- title .Title -}}
  {{- if .Site.Params.withSiteTitle }} {{ .Site.Params.titleDelimiter }} {{ .Site.Title }}{{- end -}}
{{- end -}}

{{- define "content" -}}
  {{- $title := title .Title -}}
  {{- $params := partial "function/params.html" -}}
  {{- $toc := .Scratch.Get "toc" -}}
  {{- $tocEmpty := eq .TableOfContents `<nav id="TableOfContents"></nav>` -}}
<div class="posterwall-wrapper">
  <div class="posterwall-description">
    {{ .Params.description | markdownify }}
  </div>
  <div class="movie-wall">
    {{ $csvPath := "data/douban/movie.csv" }}
    {{ $items := slice }}
    {{ with resources.Get $csvPath }}
        {{ $opts := dict "delimiter" "," }}
        {{ $items = . | transform.Unmarshal $opts }}
    {{ else }}
        {{ errorf "æ— æ³•è·å–èµ„æº %q" $csvPath }}
    {{ end }}
    {{ range $idx, $item := $items }}
        {{ if ne $idx 0 }}
        {{ $rating := float (index $item 6) }}
        <div class="movie-item" style="display: none;">
            <div class="movie-cover">
            <img src="{{ index $item 3 }}" alt="{{ index $item 1 }}" loading="lazy" width="200" referrer-policy="no-referrer">
            <div class="movie-info">
                <div class="movie-title"><a rel="noreferrer" href="{{ index $item 5 }}" target="_blank">{{ index $item 1 }}</a></div>
                <div class="movie-rating">
                    <div class="rating">
                        <span class="allstardark">
                            <span class="allstarlight" style="width:{{ mul 10 $rating }}%"></span>
                        </span>
                        <span class="rating_nums">{{ index $item 6 }}</span>
                    </div>
                </div>
                <div class="movie-card">{{ index $item 12 }}</div>
                <div class="movie-comment">{{ index $item 9 }}</div>
            </div>
            </div>
        </div>
        {{ end }}
    {{ end }}
  </div>
  <button id="loadMore">åŠ è½½æ›´å¤š</button>
</div>

<script>
  let visibleMovies = 20;
  const movieItems = document.querySelectorAll('.movie-item');
  const loadMoreButton = document.getElementById('loadMore');

  function updateVisibility() {
    movieItems.forEach((movie, idx) => {
      movie.style.display = idx < visibleMovies ? 'block' : 'none';
    });

    if (visibleMovies >= movieItems.length) {
      loadMoreButton.style.display = 'none';
    }
  }

  loadMoreButton.addEventListener('click', () => {
    visibleMovies += 20;
    updateVisibility();
  });

  updateVisibility();
</script>
{{ end }}
```

> [!IMPORTANT]
> - ä»£ç ä¸­åŒ…æ‹¬äº†é¡µé¢å…ƒç´ å’ŒåŠ è½½æ›´å¤šæ•°æ®çš„ `js` ä»£ç ï¼Œå¹¶ä¸”åœ¨é¡µé¢æ ‡é¢˜ä¸‹æ·»åŠ äº†ä¸€ä¸ªé¡µé¢æè¿°ï¼Œæ–¹ä¾¿åœ¨ markdown æ–‡ä»¶ä¸­æ›´æ”¹æè¿°ä¿¡æ¯ï¼Œä¹Ÿä¾¿äºè°ƒæ•´æ ·å¼ã€‚
> - åŒæ ·é¡µé¢ä¸­è¯„åˆ†æ˜Ÿçº§çš„å‘½å `allstarlight` ä¹Ÿæ˜¯ä¸ä¹‹å‰è±†ç“£æ¡ç›®çŸ­ä»£ç ä¸€è‡´ï¼Œæ–¹ä¾¿ä¸€èµ·è°ƒæ•´ã€‚
> - é¡¶éƒ¨çš„å…ƒç´ é€‚åº”ä¸»é¢˜ `Fixit`ï¼Œå…¶ä»–ä¸»é¢˜è‡ªè¡Œæ›´æ”¹ã€‚

å®Œæˆååœ¨ `custom.scss` ä¸­æ·»åŠ æ ·å¼ä»£ç ï¼š

```scss
// ç”µå½±æµ·æŠ¥å¢™æ ·å¼
.posterwall-description {
  margin: 10px;
  text-align: center;
}
.movie-wall {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 3px;
  padding: 3px;
}

.movie-item {
  width: 100%;
  margin-bottom: 0;
}

.movie-cover {
  position: relative;
  overflow: hidden;
  aspect-ratio: 2 / 3;
}

.movie-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.movie-info {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  padding: 10px;
  opacity: 0;
  transition: opacity 0.3s ease;
  overflow: auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.movie-cover:hover img {
  transform: scale(1.1);
}

.movie-cover:hover .movie-info {
  opacity: 1;
}

#loadMore {
  display: block;
  margin: 20px auto;
  padding: 10px 20px;
  background-color: lighten($color-accent,0.1);
  color: white;
  border: none;
  cursor: pointer;
}

#loadMore:hover {
  background-color: gray;
}

.movie-info .movie-rating {
  display: flex;
  align-items: center;
  margin-top: 3px;
  margin-bottom: 3px;
}
.movie-info .movie-rating .rating .rating_nums {
  font-size: 1.0em;
  color: #fff;
}

.movie-info .movie-card {
  margin: 5px 0;
  font-size: 0.7em;
  color: #fff;
}

.movie-info .movie-comment {
  margin: 5px 0;
  font-size: 0.7em;
  color: #fff;
}
```
### ä½¿ç”¨

åœ¨ `content` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `posterwall.md` æ–‡ä»¶ï¼Œ`Front Matter` ä¿¡æ¯å¡«å†™å¦‚ä¸‹ï¼Œæ ‡é¢˜å¯æè¿°å¯ä»¥è‡ªç”±æ›´æ”¹ï¼š
```yaml
---
title: æµ·æŠ¥å¢™
layout: "posterwall"
description: "è¿™é‡Œæ˜¯æˆ‘å·²è§‚çœ‹ç”µå½±çš„æµ·æŠ¥å¢™ï¼Œæ•°æ®æ¥æºäºè±†ç“£ã€‚"
---
```

æ·»åŠ åå°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªèœå•é¡µé¢æ¥æŒ‡å‘æµ·æŠ¥å¢™ï¼Œæœ€ç»ˆæ•ˆæœå¯ä»¥è®¿é—® ğŸ‘‰ [è§‚å½±é¡µé¢](https://blog.grew.cc/posterwall)

## å›¾ç‰‡åœ°å€æ›¿æ¢

`CSV` æ–‡ä»¶ä¸­çš„å›¾ç‰‡åœ°å€æ˜¯ `douban-action` ä½œè€…åä»£çš„åœ°å€ï¼Œè¿‘æœŸå›¾ç‰‡æŒ‚äº†ï¼Œè€Œ `Neodb` æä¾› `API`ï¼Œæ‰€ä»¥è¿™é‡Œå°†å›¾ç‰‡æ›¿æ¢ä¸º ` Neodb ` åœ°å€ï¼Œæ–¹æ³•å¦‚ä¸‹, æµ·æŠ¥å¢™é¡µé¢ä»£ç å’Œä½ç½®éƒ½ä¸€è‡´ï¼š

åœ¨ `{{ $rating := float (index $item 6) }}` è¿™è¡Œä»£ç ä¸‹æ·»åŠ ä¸‹é¢ä¸¤è¡Œï¼š

```hugo
{{ $dbUrl := printf "https://neodb.social/api/catalog/fetch?url=%s" (index $item 5) }}
{{ $dbFetch := (resources.GetRemote $dbUrl) | transform.Unmarshal }}
```

ç„¶åå°†å›¾ç‰‡åœ°å€æ›´æ¢ï¼š

```diff
-src=" {{ index $item 3 }} " 
+src=" {{ $dbFetch.cover_image_url }} "
```

## è§‚å½±é¡µé¢æ›´æ–°

```html
{{- define "title" -}}
  {{- title .Title -}}
  {{- if .Site.Params.withSiteTitle }} {{ .Site.Params.titleDelimiter }} {{ .Site.Title }}{{- end -}}
{{- end -}}

{{- define "main" -}}
  {{- $title := title .Title -}}
<div class="movies-wrapper">
  <div class="movies-description">
    {{ .Params.description | markdownify }}
  </div>
  
<!-- ä¿®æ”¹ç­›é€‰æ§åˆ¶åŒºHTMLç»“æ„ -->
<div class="filter-sort-controls">
    <div class="filter-container">
      <!-- å¹´ä»½ç­›é€‰ -->
      <div class="filter-section">
        <button class="filter-button" id="toggleYearFilter">å¹´ä»½ç­›é€‰ <span class="arrow-down">â–¼</span></button>
        <div class="filter-options" id="yearOptions">
          <div class="filter-options-grid" id="yearFilters"></div>
          <button class="reset-filters" data-type="year">é‡ç½®å¹´ä»½</button>
        </div>
      </div>
      
      <!-- ç±»å‹ç­›é€‰ -->
      <div class="filter-section">
        <button class="filter-button" id="toggleGenreFilter">ç±»å‹ç­›é€‰ <span class="arrow-down">â–¼</span></button>
        <div class="filter-options" id="genreOptions">
          <div class="filter-options-grid" id="genreFilters"></div>
          <button class="reset-filters" data-type="genre">é‡ç½®ç±»å‹</button>
        </div>
      </div>
  
      <!-- æ’åº -->
      <div class="sort-section">
        <button class="sort-button" id="toggleSort">æ’åºæ–¹å¼ <span class="arrow-down">â–¼</span></button>
        <div class="sort-options" id="sortOptions">
            <button class="sort-option" data-sort="time" data-order="desc">è§‚å½±æ—¶é—´ (å€’åº)</button>
            <button class="sort-option" data-sort="time" data-order="asc">è§‚å½±æ—¶é—´ (æ­£åº)</button>
            <button class="sort-option" data-sort="rating" data-order="desc">è¯„åˆ† (é«˜â†’ä½)</button>
            <button class="sort-option" data-sort="rating" data-order="asc">è¯„åˆ† (ä½â†’é«˜)</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="movies-wall">
    {{ $csvPath := "data/douban/movie.csv" }}
    {{ $items := slice }}
    {{ with resources.Get $csvPath }}
        {{ $opts := dict "delimiter" "," }}
        {{ $items = . | transform.Unmarshal $opts }}
    {{ else }}
        {{ errorf "æ— æ³•è·å–èµ„æº %q" $csvPath }}
    {{ end }}
    
    {{ range $idx, $item := $items }}
        {{ if ne $idx 0 }}
        {{ $id := index $item 0 }}
        {{ $title := index $item 1 }}
        {{ $poster := index $item 3 }}
        {{ $pubdate := index $item 4 }}
        {{ $url := index $item 5 }}
        {{ $rating := float (index $item 6) }}
        {{ $genres := index $item 7 }}
        {{ $comment := index $item 9 }}
        {{ $card := index $item 12 }}
        {{ $star_time := index $item 11 }}
        
        {{ $year := cond (findRE "\\d{4}" $pubdate) (index (findRE "\\d{4}" $pubdate) 0) "" }}
        
        <div class="movie-item" 
             data-id="{{ $id }}" 
             data-year="{{ $year }}" 
             data-genres="{{ $genres }}" 
             data-rating="{{ $rating }}" 
             data-time="{{ $star_time }}">
            <div class="movie-cover">
                <img src="{{ $poster }}" alt="{{ $title }}" loading="lazy" referrer-policy="no-referrer">
                <div class="movie-info">
                    <div class="movie-title"><a rel="noreferrer" href="{{ $url }}" target="_blank">{{ $title }}</a></div>
                    <div class="movie-rating">
                        <div class="rating">
                            <span class="allstardark">
                                <span class="allstarlight" style="width:{{ mul 10 $rating }}%"></span>
                            </span>
                            <span class="rating_nums">{{ $rating }}</span>
                        </div>
                    </div>
                    <div class="movie-card">{{ $card }}</div>
                    {{ if $comment }}
                    <div class="movie-comment">{{ $comment }}</div>
                    {{ end }}
                </div>
            </div>
        </div>
        {{ end }}
    {{ end }}
  </div>
  
  <!-- åˆ†é¡µæ§åˆ¶ -->
  <div class="pagination-controls">
    <button id="prevPage" disabled>ä¸Šä¸€é¡µ</button>
    <span id="pageInfo">ç¬¬ <span id="currentPage">1</span> é¡µï¼Œå…± <span id="totalPages">1</span> é¡µ</span>
    <button id="nextPage">ä¸‹ä¸€é¡µ</button>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
      // ç”µå½±é¡¹å…ƒç´ 
      const movieItems = document.querySelectorAll('.movie-item');
      // ç­›é€‰å’Œæ’åºå…ƒç´ 
      const toggleYearFilter = document.getElementById('toggleYearFilter');
      const yearOptions = document.getElementById('yearOptions');
      const toggleGenreFilter = document.getElementById('toggleGenreFilter');
      const genreOptions = document.getElementById('genreOptions');
      const toggleSort = document.getElementById('toggleSort');
      const sortOptions = document.getElementById('sortOptions');
      const yearFilters = document.getElementById('yearFilters');
      const genreFilters = document.getElementById('genreFilters');
      const sortButtons = document.querySelectorAll('.sort-option');
      
      // åˆ†é¡µå…ƒç´ 
      const prevPageBtn = document.getElementById('prevPage');
      const nextPageBtn = document.getElementById('nextPage');
      const currentPageEl = document.getElementById('currentPage');
      const totalPagesEl = document.getElementById('totalPages');
      
      // åˆ†é¡µé…ç½®
      let itemsPerRow = window.innerWidth < 768 ? 2 : (window.innerWidth < 992 ? 3 : 6);
      const rowsPerPage = 5;
      let itemsPerPage = itemsPerRow * rowsPerPage;
      
      // ç­›é€‰å’Œæ’åºçš„çŠ¶æ€
      let activeFilters = {
        years: [],
        genres: []
      };
      let currentSort = {
        field: 'time',
        order: 'desc'
      };
      let currentPage = 1;
      
      // åˆå§‹åŒ–
      initializeFilters();
      updateDisplay();
      
      // åˆå§‹åŒ–ç­›é€‰å™¨ï¼ˆä¿®æ”¹éƒ¨åˆ†ï¼‰
      function initializeFilters() {
        // æ”¶é›†æ‰€æœ‰å¹´ä»½å’Œç±»å‹
        const years = new Set();
        const genres = new Set();
        
        movieItems.forEach(item => {
          const year = item.dataset.year;
          if (year) years.add(year);
          
          const genreList = item.dataset.genres.split(',');
          genreList.forEach(genre => {
            if (genre) genres.add(genre.trim());
          });
        });
        
        // ç”Ÿæˆå¹´ä»½æŒ‰é’®
        const sortedYears = Array.from(years).sort((a, b) => b - a);
        sortedYears.forEach(year => {
          const btn = document.createElement('button');
          btn.className = 'filter-option-btn';
          btn.textContent = year;
          btn.dataset.value = year;
          btn.addEventListener('click', function() {
            this.classList.toggle('active');
            const index = activeFilters.years.indexOf(year);
            if (index === -1) {
              activeFilters.years.push(year);
            } else {
              activeFilters.years.splice(index, 1);
            }
            currentPage = 1;
            updateDisplay();
          });
          yearFilters.appendChild(btn);
        });
  
        // ç”Ÿæˆç±»å‹æŒ‰é’® 
        const sortedGenres = Array.from(genres).sort();
        sortedGenres.forEach(genre => {
          const btn = document.createElement('button');
          btn.className = 'filter-option-btn';
          btn.textContent = genre;
          btn.dataset.value = genre;
          btn.addEventListener('click', function() {
            this.classList.toggle('active');
            const index = activeFilters.genres.indexOf(genre);
            if (index === -1) {
              activeFilters.genres.push(genre);
            } else {
              activeFilters.genres.splice(index, 1);
            }
            currentPage = 1;
            updateDisplay();
          });
          genreFilters.appendChild(btn);
        });
  
        // é‡ç½®ç­›é€‰é€»è¾‘ï¼ˆä¿®æ”¹éƒ¨åˆ†ï¼‰
        document.querySelectorAll('.reset-filters').forEach(btn => {
          btn.addEventListener('click', function() {
            const type = this.dataset.type;
            if (type === 'year') {
              activeFilters.years = [];
              yearFilters.querySelectorAll('.active').forEach(b => b.classList.remove('active'));
            } else {
              activeFilters.genres = [];
              genreFilters.querySelectorAll('.active').forEach(b => b.classList.remove('active'));
            }
            currentPage = 1;
            updateDisplay();
          });
        });
      }
  
      // ç­›é€‰ç”µå½±ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
      function filterMovies() {
        const filtered = Array.from(movieItems).filter(item => {
          const year = item.dataset.year;
          const genres = item.dataset.genres.split(',').map(g => g.trim());
          
          const yearMatch = activeFilters.years.length === 0 || activeFilters.years.includes(year);
          const genreMatch = activeFilters.genres.length === 0 || 
                            activeFilters.genres.some(g => genres.includes(g));
          
          return yearMatch && genreMatch;
        });
        
        return filtered;
      }
  
      // æ’åºç”µå½±ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
      function sortMovies(movies) {
        const sorted = movies.sort((a, b) => {
          let valueA, valueB;
          
          if (currentSort.field === 'time') {
            valueA = a.dataset.time;
            valueB = b.dataset.time;
          } else {
            valueA = parseFloat(a.dataset.rating);
            valueB = parseFloat(b.dataset.rating);
          }
          
          if (valueA === valueB) {
            return 0;
          }
          
          return currentSort.order === 'asc' ? 
            (valueA > valueB ? 1 : -1) : 
            (valueA < valueB ? 1 : -1);
        });
        
        
        return sorted;
      }
  
      // æ›´æ–°æ˜¾ç¤ºï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
      function updateDisplay() {
        // è·å–æ‰€æœ‰ç”µå½±é¡¹ç›®çš„åŸå§‹å¼•ç”¨
        const allMovieItems = Array.from(document.querySelectorAll('.movie-item'));
        
        // åº”ç”¨ç­›é€‰
        const filteredMovies = filterMovies();
        
        // åº”ç”¨æ’åº
        const sortedMovies = sortMovies(filteredMovies);
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯
        const totalPages = Math.ceil(sortedMovies.length / itemsPerPage) || 1;
        currentPage = currentPage > totalPages ? totalPages : currentPage;
        currentPageEl.textContent = currentPage;
        totalPagesEl.textContent = totalPages;
        
        // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
        prevPageBtn.disabled = currentPage <= 1;
        nextPageBtn.disabled = currentPage >= totalPages;
      
        // è®¡ç®—å½“å‰é¡µé¢åº”æ˜¾ç¤ºçš„èŒƒå›´
        const startIdx = (currentPage - 1) * itemsPerPage;
        const endIdx = startIdx + itemsPerPage;
        
        // å…ˆéšè—æ‰€æœ‰ç”µå½±
        allMovieItems.forEach(item => {
          item.style.display = 'none';
        });
        
        // åªæ˜¾ç¤ºå½“å‰é¡µä¸­ç­›é€‰å’Œæ’åºåçš„ç”µå½±
        sortedMovies.forEach((item, index) => {
          if (index >= startIdx && index < endIdx) {
            item.style.display = 'block';
          }
        });
        
        // é‡æ–°æ’åºDOMå…ƒç´  (ä»…å¤„ç†ç­›é€‰åçš„å…ƒç´ )
        const moviesWall = document.querySelector('.movies-wall');
        sortedMovies.forEach(item => {
          moviesWall.appendChild(item);
        });
      }
      
      // ä¿®æ”¹ filterMovies å‡½æ•°ä»¥ç¡®ä¿å®ƒæ­£ç¡®å¤„ç†ç­›é€‰é€»è¾‘
      function filterMovies() {
        return Array.from(movieItems).filter(item => {
          const year = item.dataset.year;
          const genres = item.dataset.genres.split(',').map(g => g.trim());
          
          // å¹´ä»½ç­›é€‰é€»è¾‘
          const yearMatch = activeFilters.years.length === 0 || 
                          activeFilters.years.includes(year);
          
          // ç±»å‹ç­›é€‰é€»è¾‘
          const genreMatch = activeFilters.genres.length === 0 || 
                          activeFilters.genres.some(g => genres.includes(g));
          
          // è°ƒè¯•è¾“å‡º
          // console.log(`ç”µå½±: ${item.querySelector('.movie-title')?.textContent} - å¹´ä»½åŒ¹é…: ${yearMatch}, ç±»å‹åŒ¹é…: ${genreMatch}`);
          
          return yearMatch && genreMatch;
        });
      }



      // äº‹ä»¶ç›‘å¬ï¼ˆä¿®æ”¹éƒ¨åˆ†ï¼‰
      toggleYearFilter.addEventListener('click', function() {
        yearOptions.classList.toggle('show');
        this.querySelector('.arrow-down').textContent = 
          yearOptions.classList.contains('show') ? 'â–²' : 'â–¼';
      });
  
      toggleGenreFilter.addEventListener('click', function() {
        genreOptions.classList.toggle('show');
        this.querySelector('.arrow-down').textContent = 
          genreOptions.classList.contains('show') ? 'â–²' : 'â–¼';
      });
  
      toggleSort.addEventListener('click', function() {
        sortOptions.classList.toggle('show');
        this.querySelector('.arrow-down').textContent = 
          sortOptions.classList.contains('show') ? 'â–²' : 'â–¼';
      });
  
      // ä¿æŒåŸæœ‰æ’åºé€»è¾‘
      sortButtons.forEach(button => {
        button.addEventListener('click', function() {
          currentSort.field = this.dataset.sort;
          currentSort.order = this.dataset.order;
          currentPage = 1;
          
          sortButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          updateDisplay();
          
          sortOptions.classList.remove('show');
          toggleSort.querySelector('.arrow-down').textContent = 'â–¼';
        });
      });
  
      // åˆ†é¡µæ§åˆ¶ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
      prevPageBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          updateDisplay();
        }
      });
  
      nextPageBtn.addEventListener('click', () => {
        const filteredMovies = filterMovies();
        const totalPages = Math.ceil(filteredMovies.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          updateDisplay();
        }
      });
  
      // ç‚¹å‡»å¤–éƒ¨å…³é—­ï¼ˆä¿®æ”¹éƒ¨åˆ†ï¼‰
      document.addEventListener('click', function(event) {
        const isFilter = event.target.closest('.filter-section');
        const isSort = event.target.closest('.sort-section'); // æ–°å¢æ’åºåŒºåŸŸåˆ¤æ–­
        
        if (!isFilter && !isSort) { // åŒæ—¶æ£€æŸ¥ä¸¤ä¸ªåŒºåŸŸ
          [yearOptions, genreOptions, sortOptions].forEach(panel => {
            if (panel.classList.contains('show')) {
              panel.classList.remove('show');
              // ä¿®å¤ç®­å¤´æ–¹å‘æ›´æ–°é€»è¾‘
              const toggleBtn = document.querySelector(`#${panel.id.replace('Options','Filter')}`);
              if(toggleBtn) {
                toggleBtn.querySelector('.arrow-down').textContent = 'â–¼';
              }
            }
          });
        }
      });
  
      // å“åº”å¼å¤„ç†ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
      window.addEventListener('resize', function() {
        const newItemsPerRow = window.innerWidth < 768 ? 2 : (window.innerWidth < 992 ? 3 : 6);
        if (newItemsPerRow !== itemsPerRow) {
          itemsPerRow = newItemsPerRow;
          itemsPerPage = itemsPerRow * rowsPerPage;
          updateDisplay();
        }
      });
    });
  </script>

<style>
/* ç”µå½±å¢™å®¹å™¨ */
.movies-wrapper {
  margin: 20px auto;
  max-width: 1200px;
}

.movies-description {
  margin: 10px;
  text-align: center;
}

/* ç”µå½±å¢™ç½‘æ ¼å¸ƒå±€ */
.movies-wall {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  grid-gap: 15px;
  padding: 15px;
}

/* å“åº”å¼å¸ƒå±€ */
@media (max-width: 992px) {
  .movies-wall {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 768px) {
  .movies-wall {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* å•ä¸ªç”µå½±é¡¹ç›® */
.movie-item {
  width: 100%;
  margin-bottom: 10px;
}

.movie-cover {
  position: relative;
  overflow: hidden;
  aspect-ratio: 2 / 3;
  border-radius: 5px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.movie-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.movie-info {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  padding: 15px;
  opacity: 0;
  transition: opacity 0.3s ease;
  overflow: auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.movie-cover:hover img {
  transform: scale(1.1);
}

.movie-cover:hover .movie-info {
  opacity: 1;
}

/* ç”µå½±ä¿¡æ¯æ ·å¼ */
.movie-title {
  font-size: 1.1em;
  font-weight: bold;
  margin-bottom: 10px;
}

.movie-title a {
  color: #fff;
  text-decoration: none;
}

.movie-title a:hover {
  text-decoration: underline;
}

/* è¯„åˆ†æ˜Ÿæ˜Ÿæ ·å¼ */
.movie-rating {
  display: flex;
  align-items: center;
  margin: 8px 0;
}

.rating .allstardark {
  display: inline-block;
  position: relative;
  color: #f99b01;
  height: 16px;
  width: 80px;
  background-size: auto 100%;
  margin-right: 8px;
  background-repeat: repeat;
  background-image: url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxwYXRoIGQ9Ik05MDguMSAzNTMuMWwtMjUzLjktMzYuOUw1NDAuNyA4Ni4xYy0zLjEtNi4zLTguMi0xMS40LTE0LjUtMTQuNS0xNS44LTcuOC0zNS0xLjMtNDIuOSAxNC41TDM2OS44IDMxNi4ybC0yNTMuOSAzNi45Yy03IDEtMTMuNCA0LjMtMTguMyA5LjMtMTIuMyAxMi43LTEyLjEgMzIuOS42IDQ1LjNsMTgzLjcgMTc5LjEtNDMuNCAyNTIuOWMtMS4yIDYuOS0uMSAxNC4xIDMuMiAyMC4zIDguMiAxNS42IDI3LjYgMjEuNyA0My4yIDEzLjRMNTEyIDc1NGwyMjcuMSAxMTkuNGM2LjIgMy4zIDEzLjQgNC40IDIwLjMgMy4yIDE3LjQtMyAyOS4xLTE5LjUgMjYuMS0zNi45bC00My40LTI1Mi45IDE4My43LTE3OS4xYzUtNC45IDguMy0xMS4zIDkuMy0xOC4zIDIuNy0xNy41LTkuNS0zMy43LTI3LTM2LjN6TTY2NC44IDU2MS42bDM2LjEgMjEwLjNMNTEyIDY3Mi43IDMyMy4xIDc3MmwzNi4xLTIxMC4zLTE1Mi44LTE0OUw0MTcuNiAzODIgNTEyIDE5MC43IDYwNi40IDM4MmwyMTEuMiAzMC43LTE1Mi44IDE0OC45eiIgZmlsbD0iI2Y5OWIwMSIvPjwvc3ZnPg==);
}

.rating .allstarlight {
  position: absolute;
  left: 0;
  color: #f99b01;
  height: 16px;
  overflow: hidden;
  background-size: auto 100%;
  background-repeat: repeat;
  background-image: url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxwYXRoIGQ9Ik05MDguMSAzNTMuMWwtMjUzLjktMzYuOUw1NDAuNyA4Ni4xYy0zLjEtNi4zLTguMi0xMS40LTE0LjUtMTQuNS0xNS44LTcuOC0zNS0xLjMtNDIuOSAxNC41TDM2OS44IDMxNi4ybC0yNTMuOSAzNi45Yy03IDEtMTMuNCA0LjMtMTguMyA5LjMtMTIuMyAxMi43LTEyLjEgMzIuOS42IDQ1LjNsMTgzLjcgMTc5LjEtNDMuNCAyNTIuOWMtMS4yIDYuOS0uMSAxNC4xIDMuMiAyMC4zIDguMiAxNS42IDI3LjYgMjEuNyA0My4yIDEzLjRMNTEyIDc1NGwyMjcuMSAxMTkuNGM2LjIgMy4zIDEzLjQgNC40IDIwLjMgMy4yIDE3LjQtMyAyOS4xLTE5LjUgMjYuMS0zNi45bC00My40LTI1Mi45IDE4My43LTE3OS4xYzUtNC45IDguMy0xMS4zIDkuMy0xOC4zIDIuNy0xNy41LTkuNS0zMy43LTI3LTM2LjN6IiBmaWxsPSIjZjk5YjAxIi8+PC9zdmc+);
}

.rating .rating_nums {
  font-size: 1.0em;
  color: #fff;
}

.movie-card {
  margin: 8px 0;
  font-size: 0.8em;
  color: #ddd;
}

.movie-comment {
  margin: 8px 0;
  font-size: 0.8em;
  color: #ddd;
  font-style: italic;
}

/* ç­›é€‰å’Œæ’åºæ§åˆ¶ */
.filter-sort-controls {
  margin: 15px;
  padding: 10px;
  background-color: #f5f5f5;
  border-radius: 5px;
}

.filter-container {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 10px;
}

.filter-section, .sort-section {
  position: relative;
  flex: 1;
  min-width: 200px;
}

.filter-button, .sort-button {
  width: 100%;
  padding: 8px 12px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  text-align: left;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.filter-options, .sort-options {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background-color: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 10px;
  z-index: 10;
  max-height: 300px;
  overflow-y: auto;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.filter-options.show, .sort-options.show {
  display: block;
}

.filter-group {
  margin-bottom: 10px;
}

.filter-group h4 {
  margin: 0 0 5px 0;
  padding-bottom: 5px;
  border-bottom: 1px solid #eee;
}

.filter-checkbox {
  display: block;
  margin: 3px 0;
  cursor: pointer;
}

.sort-option {
  display: block;
  width: 100%;
  padding: 5px 10px;
  margin: 3px 0;
  text-align: left;
  background: none;
  border: none;
  cursor: pointer;
}

.sort-option:hover, .sort-option.active {
  background-color: #f0f0f0;
}

.reset-filters {
  display: block;
  width: 100%;
  padding: 5px 10px;
  margin-top: 10px;
  background-color: #f0f0f0;
  border: 1px solid #ddd;
  border-radius: 3px;
  cursor: pointer;
}

/* åˆ†é¡µæ§åˆ¶ */
.pagination-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 20px 0;
  gap: 15px;
}

.pagination-controls button {
  padding: 8px 15px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.pagination-controls button:hover:not([disabled]) {
  background-color: #2980b9;
}

.pagination-controls button[disabled] {
  background-color: #ccc;
  cursor: not-allowed;
}

#pageInfo {
  font-size: 0.9em;
  color: #666;
}

/* æ–°å¢ç­›é€‰æŒ‰é’®æ ·å¼ */
.filter-options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 8px;
    padding: 10px 0;
  }
  
  .filter-option-btn {
    padding: 6px 10px;
    border: 1px solid #ddd;
    border-radius: 15px;
    background: #f8f9fa;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9em;
    white-space: nowrap;
  }
  
  .filter-option-btn.active {
    background: #3498db;
    color: white;
    border-color: #3498db;
  }
</style>
{{- end -}}


```







## å‚è€ƒ

- [Hugo ã€Œè¿‘æœŸã€çŸ­ä»£ç ï¼ˆåŸºäº Doumark Actionsï¼‰](https://immmmm.com/hugo-shortcodes-recently-by-douban/)
- [Koobaiåšå®¢](https://koobai.com/movies/)
- [å…ƒåŸ¹çš„å…ƒè§†è§’](https://blog.yuanpei.me/)
- [è±†ç“£ä¹¦å½±éŸ³åŒæ­¥ GitHub Action](https://imnerd.org/doumark.html)
- [CSV: unexpected data type [][]string in file](https://discourse.gohugo.io/t/csv-unexpected-data-type-string-in-file/17421/3)